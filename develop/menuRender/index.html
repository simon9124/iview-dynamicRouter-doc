<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>菜单渲染 | iView DynamicRouter</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/iview-dynamicRouter-doc/favicon.ico">
    <meta name="description" content="基于 iview-admin 的后端动态生成路由模板">
    <link rel="preload" href="/iview-dynamicRouter-doc/assets/css/0.styles.8b9d209c.css" as="style"><link rel="preload" href="/iview-dynamicRouter-doc/assets/js/app.05072671.js" as="script"><link rel="preload" href="/iview-dynamicRouter-doc/assets/js/2.cbc301c3.js" as="script"><link rel="preload" href="/iview-dynamicRouter-doc/assets/js/8.8b48d297.js" as="script"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/10.3a577142.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/11.4ed2a332.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/12.70f2d81f.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/13.fb68dbed.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/14.d04a55e5.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/15.23f75260.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/16.81f5a864.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/17.f75682ea.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/18.20135df0.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/19.5b6354de.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/20.bc9487e3.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/21.285706ea.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/22.cee5b6d1.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/23.83bfe31c.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/24.7f35b35e.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/25.62b31e3a.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/26.1f6064fc.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/27.a41cc54f.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/3.2dad5878.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/4.c2c9c270.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/5.80e4ca2a.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/6.13d890a1.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/7.6c7b94b8.js"><link rel="prefetch" href="/iview-dynamicRouter-doc/assets/js/9.cefde122.js">
    <link rel="stylesheet" href="/iview-dynamicRouter-doc/assets/css/0.styles.8b9d209c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/iview-dynamicRouter-doc/" class="home-link router-link-active"><!----> <span class="site-name">iView DynamicRouter</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/iview-dynamicRouter-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/iview-dynamicRouter-doc/document/guide/" class="nav-link">
  配置文档
</a></div><div class="nav-item"><a href="/iview-dynamicRouter-doc/develop/axios/" class="nav-link">
  开发指南
</a></div><div class="nav-item"><a href="https://github.com/simon9124/iview-dynamicRouter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/iview-dynamicRouter-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/iview-dynamicRouter-doc/document/guide/" class="nav-link">
  配置文档
</a></div><div class="nav-item"><a href="/iview-dynamicRouter-doc/develop/axios/" class="nav-link">
  开发指南
</a></div><div class="nav-item"><a href="https://github.com/simon9124/iview-dynamicRouter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>1.axios 改造</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iview-dynamicRouter-doc/develop/axios/" class="sidebar-link">总览</a></li><li><a href="/iview-dynamicRouter-doc/develop/axios/achievement.html" class="sidebar-link">总结 &amp; 成果</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>2.mockData</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iview-dynamicRouter-doc/develop/mockData/" class="sidebar-link">总览</a></li><li><a href="/iview-dynamicRouter-doc/develop/mockData/achievement.html" class="sidebar-link">总结 &amp; 成果</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>3.路由数据处理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iview-dynamicRouter-doc/develop/routerData/" class="sidebar-link">总览</a></li><li><a href="/iview-dynamicRouter-doc/develop/routerData/achievement.html" class="sidebar-link">总结 &amp; 成果</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>4.路由改造</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iview-dynamicRouter-doc/develop/routerRemould/debug.html" class="sidebar-link">调试</a></li><li><a href="/iview-dynamicRouter-doc/develop/routerRemould/" class="sidebar-link">总览</a></li><li><a href="/iview-dynamicRouter-doc/develop/routerRemould/achievement.html" class="sidebar-link">总结 &amp; 成果</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>5.菜单渲染</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iview-dynamicRouter-doc/develop/menuRender/menuVSRouter.html" class="sidebar-link">菜单VS路由</a></li><li><a href="/iview-dynamicRouter-doc/develop/menuRender/" class="active sidebar-link">总览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iview-dynamicRouter-doc/develop/menuRender/#store-module-app-js" class="sidebar-link">store &gt; module &gt; app.js</a></li><li class="sidebar-sub-header"><a href="/iview-dynamicRouter-doc/develop/menuRender/#libs-router-util-js" class="sidebar-link">libs &gt; router-util.js</a></li><li class="sidebar-sub-header"><a href="/iview-dynamicRouter-doc/develop/menuRender/#router-index-js" class="sidebar-link">router &gt; index.js</a></li></ul></li><li><a href="/iview-dynamicRouter-doc/develop/menuRender/achievement.html" class="sidebar-link">总结 &amp; 成果</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="菜单渲染"><a href="#菜单渲染" class="header-anchor">#</a> 菜单渲染</h1> <p><a href="/iview-dynamicRouter-doc/develop/routerData/">路由数据处理</a>、<a href="/iview-dynamicRouter-doc/develop/routerRemould/">路由改造</a>、<code>菜单渲染</code> 是整个开发步骤的核心部分。在前两个步骤已经完备的基础上，<code>菜单管理</code> 就没那么复杂了，目的也很单纯 —— 根据动态路由，渲染动态菜单</p> <div class="custom-block tip"><p class="custom-block-title">菜单 VS 路由</p> <p>既然 <code>iview-admin</code> 已经封装好了，菜单难道不就是路由？</p> <p><a href="/iview-dynamicRouter-doc/develop/menuRender/menuVSRouter.html">是，但又不完全是 →</a></p></div> <img src="/iview-dynamicRouter-doc/assets/菜单渲染.png" class="img-margin-top"> <ul><li>store &gt; module &gt; <a href="/iview-dynamicRouter-doc/develop/menuRender/#store-module-app-js">app.js</a> / <a href="https://github.com/simon9124/iview-dynamicRouter/blob/master/src/store/module/app.js" target="_blank">完整代码 →</a></li> <li>store &gt; <a href="/iview-dynamicRouter-doc/develop/menuRender/#libs-router-util-js">router-util.js</a> / <a href="https://github.com/simon9124/iview-dynamicRouter/blob/master/src/libs/router-util.js" target="_blank">完整代码 →</a></li> <li>router &gt; <a href="/iview-dynamicRouter-doc/develop/menuRender/#router-index-js">index.js</a> / <a href="https://github.com/simon9124/iview-dynamicRouter/blob/master/src/router/index.js" target="_blank">完整代码 →</a></li></ul> <h2 id="store-module-app-js"><a href="#store-module-app-js" class="header-anchor">#</a> store &gt; module &gt; app.js</h2> <h4 id="_1-state-追加-menulist，mutations-追加-setmenulist，修改-state-menulist"><a href="#_1-state-追加-menulist，mutations-追加-setmenulist，修改-state-menulist" class="header-anchor">#</a> 1.<code>state</code> 追加 <code>menuList</code>，<code>mutations</code> 追加 <code>setMenuList</code>，修改 <code>state.menuList</code></h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>state<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  menuList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 菜单数据</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setMenuList</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>menuList <span class="token operator">=</span> <span class="token function">getMenuByRouter</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>menuList<span class="token punctuation">,</span> data<span class="token punctuation">.</span>access<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-getters-改造-menulist，从-state-menulist-中渲染动态菜单"><a href="#_2-getters-改造-menulist，从-state-menulist-中渲染动态菜单" class="header-anchor">#</a> 2.<code>getters</code> 改造 <code>menuList</code>，从 <code>state.menuList</code> 中渲染动态菜单</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">menuList</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters<span class="token punctuation">,</span> rootState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token comment">//   getMenuByRouter(routers, rootState.user.access),</span>
  state<span class="token punctuation">.</span>menuList<span class="token punctuation">,</span> <span class="token comment">// 改造：动态菜单渲染</span>
</code></pre></div><h4 id="_3-actions-的-addrouterdata-调用-setmenulist-渲染动态菜单"><a href="#_3-actions-的-addrouterdata-调用-setmenulist-渲染动态菜单" class="header-anchor">#</a> 3.<code>actions</code> 的 <code>addRouterData</code> 调用 <code>setMenuList</code> 渲染动态菜单</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 动态添加路由数据 -&gt; 首次登录挂载路由</span>
<span class="token function">addRouterData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> rootState <span class="token punctuation">}</span><span class="token punctuation">,</span> routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态添加路由</span>
  <span class="token function">routerUpdateHandle</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动添加路由数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;动态添加路由：&quot;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> menuList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 菜单数据未处理前，看看渲染后的动态菜单</span>
  <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;setMenuList&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    menuList<span class="token operator">:</span> menuList<span class="token punctuation">,</span>
    access<span class="token operator">:</span> rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>还是老办法~<code>退出登录</code> -&gt; <code>刷新页面</code> -&gt; <code>用户登录</code>，测！</p> <img src="/iview-dynamicRouter-doc/assets/菜单改造_菜单处理前.png" style="width:100%;"> <div class="custom-block tip"><p class="custom-block-title">确实，还需要对菜单数据进行处理</p> <p>控制台的 <code>动态路由数据</code> 已经处理好，没毛病 ~</p> <p>菜单数据暂时与路由相同（未经处理），配置的 <code>二级大屏</code> 和 <code>三级大屏</code> 本应是子菜单（<code>parentId</code> 不是 <code>root</code> 而是与父菜单的 <code>id</code> 相同），不应该出现在根菜单的位置，也再次验证了 <a href="/iview-dynamicRouter-doc/develop/menuRender/menuVSRouter.html"><strong>菜单和路由不完全一样，需要对菜单数据进行处理</strong></a></p></div> <h4 id="_4-actions-的-addrouterdata调用-menulisthanding-方法做-菜单数据处理"><a href="#_4-actions-的-addrouterdata调用-menulisthanding-方法做-菜单数据处理" class="header-anchor">#</a> 4.<code>actions</code> 的 <code>addRouterData</code>调用 <code>menuListHanding</code> 方法做 <code>菜单数据处理</code></h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> menuListHanding <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/libs/router-util'</span> <span class="token comment">// 遍历菜单数据，将&quot;原本不应挂载在根菜单&quot;的数据，重新挂载到相应位置</span>
</code></pre></div><p><a href="/iview-dynamicRouter-doc/develop/menuRender/#libs-router-util-js"><code>menuListHanding</code> 方法 →</a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 动态添加路由数据 -&gt; 首次登录挂载路由</span>
<span class="token function">addRouterData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> rootState <span class="token punctuation">}</span><span class="token punctuation">,</span> routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.动态添加路由（不会立刻刷新，需要手动往router.options.routes里添加数据） */</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态添加路由</span>
  <span class="token function">routerUpdateHandle</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动添加路由数据</span>
  <span class="token comment">/* 2.处理菜单数据 */</span>
  <span class="token keyword">var</span> menuList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  menuList <span class="token operator">=</span> <span class="token function">menuListHanding</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将&quot;原本不应挂载在根菜单&quot;的数据，重新挂载到相应位置</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;动态添加路由：&quot;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;左侧动态菜单：&quot;</span><span class="token punctuation">,</span> menuList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* 3.提交到 setMenuList，修改state.menuList */</span>
  <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;setMenuList&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    menuList<span class="token operator">:</span> menuList<span class="token punctuation">,</span>
    access<span class="token operator">:</span> rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><code>退出登录</code> -&gt; <code>刷新页面</code> -&gt; <code>用户登录</code>，再再再~再测！</p> <img src="/iview-dynamicRouter-doc/assets/菜单改造_菜单处理后.png" style="width:100%;"> <div class="custom-block tip"><p class="custom-block-title">恭喜！菜单处理成功</p> <p><code>动态添加路由</code>、<code>左侧动态菜单</code>，二者不同，又都已处理好：</p> <ul><li>共用同 1 组数据，即 <code>接口回文数据</code></li> <li>实现 <code>不同种类的路由挂载</code></li> <li>实现 <code>二级/多级大屏</code> 在 <code>子菜单渲染</code></li></ul> <p>一路跟到这里的伙伴辛苦呀，我们一起把 <code>动态路由</code> 和 <code>动态菜单</code> 做好啦 ~ 开心吧 😀<br> <code>登录后刷新一下页面</code> 试试？😱</p></div> <h2 id="libs-router-util-js"><a href="#libs-router-util-js" class="header-anchor">#</a> libs &gt; router-util.js</h2> <h4 id="函数-menulisthanding：遍历菜单数据，将-原本不应挂载在根菜单-的数据，重新挂载-到相应位置"><a href="#函数-menulisthanding：遍历菜单数据，将-原本不应挂载在根菜单-的数据，重新挂载-到相应位置" class="header-anchor">#</a> 函数 <code>menuListHanding</code>：遍历菜单数据，将 <code>原本不应挂载在根菜单</code> 的数据，<code>重新挂载</code> 到相应位置</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// @函数：遍历菜单数据，将&quot;原本不应挂载在根菜单&quot;的数据，重新挂载到相应位置</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">menuListHanding</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">menuList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.copy一份menuList，以便递归函数用</span>
  <span class="token keyword">const</span> menuListOrg <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 2.递归函数：比对menuList和menuListOrg，挂载数据到menuList</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> listOrg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">menu<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      listOrg<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有meta里有parentId且parentId与另一个meta里的id相同 -&gt; copy并删除parentId键 -&gt; 将copy塞入meta</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          data<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>parentId <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
          menu<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>id <span class="token operator">===</span> data<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>parentId
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> dataCopy <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          Vue<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dataCopy<span class="token punctuation">.</span>meta<span class="token punctuation">,</span> <span class="token string">'parentId'</span><span class="token punctuation">)</span>
          menu<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dataCopy<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 连同新挂载的数据一起根据sort排序，不可忽略否则新挂载到菜单的数据顺序有误</span>
      menu<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">arraySort</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token string">'desc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">handleData</span><span class="token punctuation">(</span>menu<span class="token punctuation">.</span>children<span class="token punctuation">,</span> listOrg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleData</span><span class="token punctuation">(</span>menuList<span class="token punctuation">,</span> menuListOrg<span class="token punctuation">)</span>
  <span class="token comment">// 3.最外层菜单做筛选</span>
  menuList <span class="token operator">=</span> menuList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">menu</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span>menu<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>notInMenu <span class="token operator">===</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(menuList);</span>
  <span class="token keyword">return</span> menuList
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://github.com/simon9124/iview-dynamicRouter/blob/master/src/libs/router-util.js#LC215" target="_blank"><code>router-util.js</code> 完整代码 →</a></p> <h2 id="router-index-js"><a href="#router-index-js" class="header-anchor">#</a> router &gt; index.js</h2> <h4 id="刷新页面-时调用-vuex-中的getrouters，解决刷新页面时左侧菜单的渲染问题："><a href="#刷新页面-时调用-vuex-中的getrouters，解决刷新页面时左侧菜单的渲染问题：" class="header-anchor">#</a> <code>刷新页面</code> 时调用 <code>vuex</code> 中的<code>getRouters</code>，解决刷新页面时左侧菜单的渲染问题：</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token constant">LOGIN_PAGE_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> homeName <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 已登录且要跳转的页面是登录页 -&gt; 跳转到homeName页</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 剩余情况：已登录且要跳转的页面不是登录页</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>hasGetInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">turnTo</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access<span class="token punctuation">,</span> next<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      store
        <span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'getUserInfo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'getRouters'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 同 getUserInfo 方法，每次刷新页面都会重新调用</span>
            <span class="token function">turnTo</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> user<span class="token punctuation">.</span>access<span class="token punctuation">,</span> next<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>同时，还需在 <code>store &gt; module &gt; app.js</code> 更新 <code>getRouters</code> 方法，<code>刷新页面</code> 时 <strong>路由不发生改变，无需调用接口</strong>，从 <strong>localStorage 获取数据，进行处理后，渲染到左侧菜单</strong> 即可</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 获取动态路由数据</span>
<span class="token function">getRouters</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> rootState <span class="token punctuation">}</span><span class="token punctuation">,</span> routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> gotRouter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 设置动态路由</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">localRead</span><span class="token punctuation">(</span><span class="token string">&quot;dynamicRouter-template&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* localStorage里dynamicRouter值为空 -&gt; 没有路由数据 -&gt; 获取路由数据 */</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 有路由数据 -&gt; 直接从localStorage里面获取 */</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取路由：从localStorage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/* 1.动态路由数据 */</span>
      gotRouter <span class="token operator">=</span> <span class="token function">filterAsyncRouter</span><span class="token punctuation">(</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">localRead</span><span class="token punctuation">(</span><span class="token string">&quot;dynamicRouter-template&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 过滤路由，路由组件转换</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;动态路由数据：&quot;</span><span class="token punctuation">,</span> gotRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/* 2.处理菜单数据 */</span>
      <span class="token keyword">var</span> menuList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>gotRouter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      menuList <span class="token operator">=</span> <span class="token function">menuListHanding</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将&quot;原本不应挂载在根菜单&quot;的数据，重新挂载到相应位置</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;左侧动态菜单：&quot;</span><span class="token punctuation">,</span> menuList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/* 3.提交到 setMenuList，修改state.menuList */</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;setMenuList&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        menuList<span class="token operator">:</span> menuList<span class="token punctuation">,</span>
        access<span class="token operator">:</span> rootState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>access
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">6/19/2020, 4:26:16 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iview-dynamicRouter-doc/develop/menuRender/menuVSRouter.html" class="prev">
        菜单VS路由
      </a></span> <span class="next"><a href="/iview-dynamicRouter-doc/develop/menuRender/achievement.html">
        总结 &amp; 成果
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/iview-dynamicRouter-doc/assets/js/app.05072671.js" defer></script><script src="/iview-dynamicRouter-doc/assets/js/2.cbc301c3.js" defer></script><script src="/iview-dynamicRouter-doc/assets/js/8.8b48d297.js" defer></script>
  </body>
</html>
